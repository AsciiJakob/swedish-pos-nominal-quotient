<!DOCTYPE html>
<html>
    <head>
        <script src="compiled_computed_tags.js"></script>
    </head>
    <body>
        <div id="sideData">
            <h3 id="fullNominalkvot">laddar</h3>
            <h3 id="enkelNominalkvot">laddar</h3>
            <h3 id="antalVerbSubst">laddar</h3>
            <div id="settingsContainer">
                <fieldset id="modelSelector">
                    <legend>Ordklasstaggningsmodell:</legend>
                    <!-- <input type="radio" name="model" id="flair"> <label for="flair">Flair</label>
                    <input type="radio" name="model" id="kb_bert"> <label for="kb_bert">KB-Bert</label> -->
                </fieldset>
                <select id="textSelector" size="10" name="textID">

                </select>
            </div>
            
        </div>
        <!-- generated by gpt from screenshot of docx table, TODO: use lookup for hovering -->
        <table class="category-table"><thead><tr><th>Code</th><th>Swedish category</th><th>Example</th></tr></thead><tbody><tr><td>AB</td><td>Adverb</td><td>inte</td></tr><tr><td>DT</td><td>Determinerare</td><td>denna</td></tr><tr><td>HA</td><td>Frågande/relativt adverb</td><td>när</td></tr><tr><td>HD</td><td>Frågande/relativt determinera</td><td>vilken</td></tr><tr><td>HP</td><td>Frågande/relativt pronomen</td><td>som</td></tr><tr><td>HS</td><td>Frågande/relativt possessivt pronomen</td><td>vars</td></tr><tr><td>IE</td><td>Infinitivmärke</td><td>att</td></tr><tr><td>IN</td><td>Interjektion</td><td>ja</td></tr><tr><td>JJ</td><td>Adjektiv</td><td>gul</td></tr><tr><td>KN</td><td>Konjunktion</td><td>och</td></tr><tr><td>NN</td><td>Substantiv</td><td>pudding</td></tr><tr><td>PC</td><td>Particip</td><td>utsänd</td></tr><tr><td>PL</td><td>Partikel</td><td>ut</td></tr><tr><td>PM</td><td>Egenamn</td><td>Mats</td></tr><tr><td>PN</td><td>Pronomen</td><td>hon</td></tr><tr><td>PP</td><td>Preposition</td><td>av</td></tr><tr><td>PS</td><td>Possessivt pronomen</td><td>hennes</td></tr><tr><td>RG</td><td>Grundtal</td><td>tre</td></tr><tr><td>RO</td><td>Ordningstal</td><td>tredje</td></tr><tr><td>SN</td><td>Subjunktion</td><td>att</td></tr><tr><td>UO</td><td>Utländskt ord</td><td>jeans</td></tr><tr><td>VB</td><td>Verb</td><td>kasta</td></tr></tbody></table>
    <div id="textContent">
    </div>

    </body>
</html>

<script>

const textContent = document.getElementById("textContent");
const numerator = ["NN", "PM", "PP", "PC"];
const denominator = ["PN", "PS", "VB", "AB"];

const params = new URLSearchParams(window.location.search);
let currentModel = params.get("model") || "flair"
let currentTextID = params.get("textID") || 0;
updateURL();
setSettingsVisuals();

renderSentences(dataFile[currentModel][currentTextID].sentences);

// store application states in url since refreshing is great but losing your state isn't.
function updateURL() {
    const newUrl = `?model=${encodeURIComponent(currentModel)}&textID=${encodeURIComponent(currentTextID)}`;
    window.history.pushState(null, '', newUrl);
}

// settings-related things
document.getElementById("settingsContainer").addEventListener("change", mouseEvent => handleSetting(mouseEvent.target));
function handleSetting(settingElement) {
    if (settingElement.name == "model") {
        if (dataFile[settingElement.id] == undefined) {
            document.getElementById(currentModel).checked = true;
            alert("Det finns ingen data från modellen i datafilen.");
            return;
        }
        if (dataFile[settingElement.id].length-1 < currentTextID) {
                // alert("Den för närvarande valda texten har inte analyserats med denna modell.");
                // doment.getElementById(currentModel).checked = true;
                // return;
                currentTextID = 0;
        }
        currentModel = settingElement.id;
        updateURL();
        setSettingsVisuals(); // update the text options to match current model (in case they have anaylized different corpuses)
        renderSentences(dataFile[currentModel][currentTextID].sentences);
    }
    console.log(settingElement);
    if (settingElement.name == "textID") {
        if (dataFile[currentModel].length-1 < settingElement.value) {
            alert("Den här texten har inte analyserats med den modell som är vald.");
            return;
        }
        currentTextID = settingElement.value;
        updateURL();
        renderSentences(dataFile[currentModel][currentTextID].sentences);
    }
}

function setSettingsVisuals() {

    // add texts
    const textSelector = document.getElementById("textSelector");
    textSelector.innerText = "";
    for (textIndex in dataFile[currentModel]) {
        const text = dataFile[currentModel][textIndex];
        textOption = document.createElement("option");
        textOption.value = textIndex;
        textOption.name = "textID";
        textOption.innerText = text.id;
        textSelector.appendChild(textOption);
    }

    
    // add models
    const modelSelector = document.getElementById("modelSelector");
    modelSelector.innerText = "";
    for (modelName of Object.keys(dataFile)) {
        const modelElement = document.createElement("input");
        modelElement.id = modelName;
        modelElement.name = "model";
        modelElement.type = "radio";

        const modelLabel = document.createElement("label");
        modelLabel.innerText = modelName;
        modelLabel.htmlFor = modelName;

        modelSelector.appendChild(modelElement);
        modelSelector.appendChild(modelLabel);
    }

    // set the models radio dial to selected 
    document.getElementById(currentModel).checked = true;

    document.getElementById("textSelector").value = currentTextID;
}

function renderSentences(sentences) {
    let countNumerator = 0;
    let countNouns = 0;
    let countDenominator = 0;
    let countVerbs = 0;

    console.log(sentences)

    textContent.innerText = "";
    for (sentence of sentences) {
        const sentenceElement = document.createElement("div");
        sentenceElement.classList = "sentence"
        for (let i=0; i < sentence.length; i++) {
            const word = sentence[i]

            const wordDiv = document.createElement("div");
            wordDiv.classList = "tooltip";
            wordDiv.innerText = word.word;

            if (numerator.includes(word.entity_group)) {
                wordDiv.classList+=" numerator"
                countNumerator++;
            }
            if (denominator.includes(word.entity_group)) {
                wordDiv.classList+=" denominator"
                countDenominator++;
            }

            if (word.entity_group == "NN")
                countNouns++;
            if (word.entity_group == "VB")
                countVerbs++;

            const tooltip = document.createElement("span");
            tooltip.classList = "tooltipText";
            tooltip.innerText = word.entity_group;
            
            
            wordDiv.appendChild(tooltip);
            sentenceElement.appendChild(wordDiv);
            if (i != sentence.length-1 && sentence[i+1].entity_group != "MAD") {
                sentenceElement.innerHTML += " "
            }
        }
        textContent.appendChild(sentenceElement);

        const spacer = document.createElement("br");
        textContent.appendChild(spacer);
    }

    document.getElementById("fullNominalkvot").innerText = "Full nominalkvot: "+(countNumerator/countDenominator);
    document.getElementById("enkelNominalkvot").innerText = "Enkel nominalkvot: "+(countNouns/countVerbs)
    document.getElementById("antalVerbSubst").innerText = "Verb: "+countVerbs+" substantiv: "+countNouns;
}




</script>

<style>
body {
    background-color: #ffe7c8;
}
#sideData {
    width: 20%;
    float: right;
    /* position: sticky; */
    position: fixed;
    top: 0;
    right:0;
}
#textSelector {
    width: 20%;
}
#textContent {
  margin: auto;
  width: 40%;
  font-size: 1.5em;
}
    /* Tooltip container */
.tooltip {
  position: relative;
  display: inline-block;
  border-bottom: 1px dotted black; /* If you want dots under the hoverable text */
  white-space: pre;
}

/* Tooltip text */
.tooltip .tooltipText {
  visibility: hidden;
  width: 120px;
  background-color: black;
  color: #fff;
  text-align: center;
  padding: 5px 0;
  border-radius: 6px;
 
  /* Position the tooltip text - see examples below! */
  position: absolute;
  z-index: 1;
}

/* Show the tooltip text when you mouse over the tooltip container */
.tooltip:hover .tooltipText {
  visibility: visible;
}
.tooltip:hover {
    background-color: rgb(105, 105, 105);
}


.denominator {
    color: orange;
}
.numerator {
        color: #69ae00
}






.category-table {
    border-collapse: collapse;
    width: 250px; /* Adjust width as needed */
    float: left;
    margin-right: 20px; /* Space between table and rest of the content */
}

.category-table th, .category-table td {
    border: 1px solid black;
    padding: 8px;
    text-align: left;
}

.category-table th {
    background-color: #f2f2f2;
}



</style>